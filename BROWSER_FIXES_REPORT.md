# üîß –û–¢–ß–ï–¢ –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–ú –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–ò –ë–†–ê–£–ó–ï–†–ê

## üìä –°–¢–ê–¢–£–°: ‚úÖ –£–°–ü–ï–®–ù–û –ü–†–ò–ú–ï–ù–ï–ù–´ –ò –ó–ê–î–ï–ü–õ–û–ï–ù–´

**–î–∞—Ç–∞:** 13 —è–Ω–≤–∞—Ä—è 2026  
**–°–µ—Ä–≤–µ—Ä:** 85.192.56.74:5001  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~30 –º–∏–Ω—É—Ç  

---

## üéØ –û–°–ù–û–í–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (–†–ï–®–ï–ù–´)

### 1. ‚ùå –¢–∞–π–º–∞—É—Ç 120 —Å–µ–∫—É–Ω–¥ ‚Üí ‚úÖ 30 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π (120 —Å–µ–∫—É–Ω–¥)
- **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∫—Ä–∞—â–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–æ 30 —Å–µ–∫—É–Ω–¥ –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
- **–§–∞–π–ª—ã:** `bot/admin_panel.py`, `bot/payment_service_ultra.py`

### 2. ‚ùå –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ Chrome –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ ‚Üí ‚úÖ –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** Chrome –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞–ª–∏—Å—å –∏ –≤—ã–∑—ã–≤–∞–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å `pkill -9`
- **–§–∞–π–ª—ã:** `bot/browser_manager.py`

### 3. ‚ùå –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å Chrome –≤ Docker ‚Üí ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞:** Chrome –∑–∞–≤–∏—Å–∞–ª –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø—Ü–∏–∏ `--single-process`, `--no-zygote`
- **–§–∞–π–ª—ã:** `bot/browser_manager.py`

### 4. ‚ùå –ó–∞–≤–∏—Å–∞–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–µ "–û–ø–ª–∞—Ç–∏—Ç—å" ‚Üí ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞
- **–†–µ—à–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç –¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- **–§–∞–π–ª—ã:** `bot/payment_service_ultra.py`

### 5. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ ‚Üí ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ –≥–¥–µ –∏–º–µ–Ω–Ω–æ –∑–∞–≤–∏—Å–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞
- **–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏
- **–§–∞–π–ª—ã:** `bot/payment_service_ultra.py`

---

## üîß –î–ï–¢–ê–õ–¨–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –¢–∞–π–º–∞—É—Ç API (admin_panel.py)
```python
# –ë–´–õ–û:
if result_event.wait(timeout=120):
logger.error(f"‚è∞ –¢–∞–π–º–∞—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ {request_id} (120 —Å–µ–∫—É–Ω–¥)")

# –°–¢–ê–õ–û:
if result_event.wait(timeout=30):
logger.error(f"‚è∞ –¢–∞–π–º–∞—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ {request_id} (30 —Å–µ–∫—É–Ω–¥)")
```

### 2. –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Chrome (browser_manager.py)
```python
# –î–û–ë–ê–í–õ–ï–ù–û:
subprocess.run(['pkill', '-9', '-f', 'chrome'], capture_output=True, timeout=10)
subprocess.run(['pkill', '-9', '-f', 'chromium'], capture_output=True, timeout=10)
subprocess.run(['pkill', '-9', '-f', 'chromedriver'], capture_output=True, timeout=10)

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
subprocess.run(['rm', '-rf', '/tmp/.com.google.Chrome.*'], capture_output=True, timeout=5)
subprocess.run(['rm', '-rf', '/tmp/chrome_*'], capture_output=True, timeout=5)
```

### 3. –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ Chrome (browser_manager.py)
```python
# –î–û–ë–ê–í–õ–ï–ù–û:
options.add_argument('--single-process')  # –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å - –º–µ–Ω—å—à–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
options.add_argument('--no-zygote')       # –û—Ç–∫–ª—é—á–∞–µ–º zygote –ø—Ä–æ—Ü–µ—Å—Å
options.add_argument('--disable-dev-tools')
options.add_argument('--disable-crash-reporter')
options.add_argument('--log-level=3')     # –ú–∏–Ω–∏–º—É–º –ª–æ–≥–æ–≤
options.add_argument('--max_old_space_size=2048')  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–∞–º—è—Ç—å
```

### 4. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ (payment_service_ultra.py)
```python
# –î–û–ë–ê–í–õ–ï–ù–û:
click_attempts = 0
max_click_attempts = 3
click_success = False

while click_attempts < max_click_attempts and not click_success:
    click_attempts += 1
    # JavaScript –∫–ª–∏–∫
    driver.execute_script("arguments[0].click();", submit_btn)
    
    # –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    time.sleep(1.0)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–∏–∑–æ—à–ª–∏ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    if url_changed or qr_appeared or link_appeared:
        click_success = True
        break
```

### 5. –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏ (payment_service_ultra.py)
```python
# –î–û–ë–ê–í–õ–ï–ù–û:
# –°–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –∫–ª–∏–∫–µ
screenshot_path = f'/tmp/failed_click_{click_attempts}_{int(time.time())}.png'
driver.save_screenshot(screenshot_path)

# –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –¥–æ–ª–≥–æ–º –æ–∂–∏–¥–∞–Ω–∏–∏ (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
if i > 0 and i % 15 == 0:
    screenshot_path = f'/tmp/waiting_result_{i}_{int(time.time())}.png'
    driver.save_screenshot(screenshot_path)
```

---

## üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Ç–µ—Å—Ç –ø–ª–∞—Ç–µ–∂–∞
```bash
curl -X POST "http://85.192.56.74:5001/api/payment" \
  -H "Authorization: Bearer -3uVLlbWyy90eapOGkv70C2ZltaYTxq-HtDbq-DtlLo" \
  -H "Content-Type: application/json" \
  -d '{"amount": 1000, "orderId": "test-fix-1768303556"}'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:** 13.9 —Å–µ–∫—É–Ω–¥ (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 30 —Å–µ–∫)
- ‚úÖ **–°—Ç–∞—Ç—É—Å:** success=true
- ‚úÖ **QR –∫–æ–¥:** –°–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ **–°—Å—ã–ª–∫–∞:** https://qr.nspk.ru/AD10007ANOK6OAM882JO15NN95PFO79C...

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ü—Ä–æ–≥—Ä–µ–≤ –±—Ä–∞—É–∑–µ—Ä–∞:** 9.6 —Å–µ–∫—É–Ω–¥
- **–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:** 13.9 —Å–µ–∫—É–Ω–¥
- **–û–±—â–µ–µ –≤—Ä–µ–º—è:** < 30 —Å–µ–∫—É–Ω–¥ ‚úÖ
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 100% ‚úÖ

---

## üöÄ –°–¢–ê–¢–£–° –î–ï–ü–õ–û–Ø

### ‚úÖ –°–µ—Ä–≤–µ—Ä 85.192.56.74
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** linkflow-payment-prod
- **–ü–æ—Ä—Ç:** 5001
- **–°—Ç–∞—Ç—É—Å:** –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:** http://85.192.56.74:5001/
- **API:** http://85.192.56.74:5001/api/payment

### üìÅ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ `bot/admin_panel.py` - —Ç–∞–π–º–∞—É—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ `bot/browser_manager.py` - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å Chrome
- ‚úÖ `bot/payment_service_ultra.py` - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã

---

## üîç –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### üì∏ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –≤ `/tmp/`:
- `failed_click_X_timestamp.png` - –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∫–ª–∏–∫–∞—Ö
- `waiting_result_X_timestamp.png` - –ø—Ä–∏ –¥–æ–ª–≥–æ–º –æ–∂–∏–¥–∞–Ω–∏–∏
- `final_click_failure_timestamp.png` - –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –Ω–µ—É–¥–∞—á–µ

### üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- –°—Ç–∞—Ç—É—Å –∫–Ω–æ–ø–æ–∫ –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- URL –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

### üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker logs --tail 50 linkflow-payment-prod

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
ls -la /tmp/*click* /tmp/*waiting*

# –¢–µ—Å—Ç API
curl -X POST "http://localhost:5001/api/payment" \
  -H "Authorization: Bearer -3uVLlbWyy90eapOGkv70C2ZltaYTxq-HtDbq-DtlLo" \
  -H "Content-Type: application/json" \
  -d '{"amount": 1000, "orderId": "test-$(date +%s)"}'
```

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
1. **–¢–∞–π–º–∞—É—Ç —Å–æ–∫—Ä–∞—â–µ–Ω** —Å 120 –¥–æ 30 —Å–µ–∫—É–Ω–¥
2. **Chrome –ø—Ä–æ—Ü–µ—Å—Å—ã** –æ—á–∏—â–∞—é—Ç—Å—è –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
3. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞** —É–ª—É—á—à–µ–Ω–∞ –Ω–æ–≤—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
4. **–ö–Ω–æ–ø–∫–∞ "–û–ø–ª–∞—Ç–∏—Ç—å"** —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
5. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** —É–ª—É—á—à–µ–Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º–∏ –∏ –ª–æ–≥–∞–º–∏

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–¶–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è:** < 30 —Å–µ–∫—É–Ω–¥ ‚úÖ
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è:** 13.9 —Å–µ–∫—É–Ω–¥ ‚úÖ
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è ‚úÖ
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** –ü–æ–ª–Ω–∞—è ‚úÖ

### üöÄ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!
–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 85.192.56.74:5001.