#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç —Ç—É—Ä–±–æ-—Å–∫–æ—Ä–æ—Å—Ç–∏ - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–ª–∞—Ç–µ–∂–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞ 8-15 —Å–µ–∫—É–Ω–¥
"""

import requests
import time
import json
import statistics

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
API_URL = "http://85.192.56.74:5001/api/payment"
API_TOKEN = "-3uVLlbWyy90eapOGkv70C2ZltaYTxq-HtDbq-DtlLo"

def test_turbo_single():
    """–¢–µ—Å—Ç –æ–¥–Ω–æ–≥–æ —Ç—É—Ä–±–æ-–ø–ª–∞—Ç–µ–∂–∞"""
    print("üöÄ –¢–ï–°–¢ –¢–£–†–ë–û-–°–ö–û–†–û–°–¢–ò - –û–î–ò–ù–û–ß–ù–´–ô –ü–õ–ê–¢–ï–ñ")
    print("=" * 50)
    
    # –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∞
    test_data = {
        "amount": 1000,
        "orderId": f"turbo-test-{int(time.time())}"
    }
    
    headers = {
        "Authorization": f"Bearer {API_TOKEN}",
        "Content-Type": "application/json"
    }
    
    print(f"üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å: {test_data}")
    print(f"üéØ –¶–µ–ª—å: 8-15 —Å–µ–∫—É–Ω–¥ (–∫–∞–∫ –≤ —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–º–∏—Ç–∞—Ö)")
    print()
    
    start_time = time.time()
    
    try:
        response = requests.post(
            API_URL,
            headers=headers,
            json=test_data,
            timeout=65
        )
        
        elapsed = time.time() - start_time
        
        print(f"üì• –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω –∑–∞ {elapsed:.1f} —Å–µ–∫—É–Ω–¥")
        print(f"üî¢ HTTP —Å—Ç–∞—Ç—É—Å: {response.status_code}")
        
        try:
            result = response.json()
            
            if result.get('success'):
                processing_time = result.get('processing_time', elapsed)
                print(f"‚úÖ –£–°–ü–ï–•! –ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω –∑–∞ {processing_time:.1f} —Å–µ–∫—É–Ω–¥")
                print(f"üîó –°—Å—ã–ª–∫–∞: {result.get('payment_link', 'N/A')[:80]}...")
                
                # –û—Ü–µ–Ω–∫–∞ —Ç—É—Ä–±–æ-—Å–∫–æ—Ä–æ—Å—Ç–∏
                if processing_time <= 12:
                    print(f"üéâ –ü–†–ï–í–û–°–•–û–î–ù–û! –í—Ä–µ–º—è {processing_time:.1f}s - –∫–∞–∫ –≤ —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–º–∏—Ç–∞—Ö!")
                    return True, processing_time
                elif processing_time <= 15:
                    print(f"‚úÖ –û–¢–õ–ò–ß–ù–û! –í—Ä–µ–º—è {processing_time:.1f}s - –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Ü–µ–ª–∏!")
                    return True, processing_time
                elif processing_time <= 20:
                    print(f"üëç –•–û–†–û–®–û! –í—Ä–µ–º—è {processing_time:.1f}s - –ø—Ä–∏–µ–º–ª–µ–º–æ")
                    return True, processing_time
                else:
                    print(f"‚ö†Ô∏è –ú–ï–î–õ–ï–ù–ù–û! –í—Ä–µ–º—è {processing_time:.1f}s - –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è")
                    return True, processing_time
            else:
                error = result.get('error', 'Unknown error')
                print(f"‚ùå –û–®–ò–ë–ö–ê: {error}")
                return False, elapsed
                    
        except json.JSONDecodeError:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {response.text}")
            return False, elapsed
            
    except requests.exceptions.Timeout:
        elapsed = time.time() - start_time
        print(f"‚è∞ –¢–ê–ô–ú–ê–£–¢ –∑–∞ {elapsed:.1f} —Å–µ–∫—É–Ω–¥")
        return False, elapsed
        
    except requests.exceptions.RequestException as e:
        elapsed = time.time() - start_time
        print(f"‚ùå –û–®–ò–ë–ö–ê –ó–ê–ü–†–û–°–ê –∑–∞ {elapsed:.1f} —Å–µ–∫—É–Ω–¥: {e}")
        return False, elapsed

def test_turbo_multiple():
    """–¢–µ—Å—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—É—Ä–±–æ-–ø–ª–∞—Ç–µ–∂–µ–π"""
    print("\nüîÑ –¢–ï–°–¢ –¢–£–†–ë–û-–°–ö–û–†–û–°–¢–ò - –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–ï –ü–õ–ê–¢–ï–ñ–ò")
    print("=" * 50)
    
    results = []
    times = []
    
    for i in range(3):
        print(f"\nüì§ –¢—É—Ä–±–æ-–ø–ª–∞—Ç–µ–∂ #{i+1}/3")
        success, processing_time = test_turbo_single()
        results.append(success)
        if success:
            times.append(processing_time)
        
        if i < 2:  # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
            print("‚è≥ –ü–∞—É–∑–∞ 30 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏...")
            time.sleep(30)
    
    print(f"\nüìä –ò–¢–û–ì–ò –¢–£–†–ë–û-–°–ö–û–†–û–°–¢–ò:")
    print(f"‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö: {sum(results)}/3")
    print(f"‚ùå –ù–µ—É–¥–∞—á–Ω—ã—Ö: {3 - sum(results)}/3")
    print(f"üìà –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: {sum(results)/3*100:.1f}%")
    
    if times:
        avg_time = statistics.mean(times)
        min_time = min(times)
        max_time = max(times)
        
        print(f"‚è±Ô∏è –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: {avg_time:.1f} —Å–µ–∫—É–Ω–¥")
        print(f"üèÉ –õ—É—á—à–µ–µ –≤—Ä–µ–º—è: {min_time:.1f} —Å–µ–∫—É–Ω–¥")
        print(f"üêå –•—É–¥—à–µ–µ –≤—Ä–µ–º—è: {max_time:.1f} —Å–µ–∫—É–Ω–¥")
        
        # –û—Ü–µ–Ω–∫–∞ –æ–±—â–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        if avg_time <= 12:
            print(f"üéâ –ü–†–ï–í–û–°–•–û–î–ù–û! –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è {avg_time:.1f}s - –∫–∞–∫ –≤ —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–º–∏—Ç–∞—Ö!")
        elif avg_time <= 15:
            print(f"‚úÖ –û–¢–õ–ò–ß–ù–û! –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è {avg_time:.1f}s - —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!")
        elif avg_time <= 20:
            print(f"üëç –•–û–†–û–®–û! –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è {avg_time:.1f}s - –ø—Ä–∏–µ–º–ª–µ–º–æ")
        else:
            print(f"‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –£–õ–£–ß–®–ï–ù–ò–Ø! –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è {avg_time:.1f}s - –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è")
    
    return sum(results) >= 2  # –°—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º –µ—Å–ª–∏ 2+ –∏–∑ 3 —Ä–∞–±–æ—Ç–∞—é—Ç

def compare_with_previous():
    """–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏"""
    print("\nüìä –°–†–ê–í–ù–ï–ù–ò–ï –° –ü–†–ï–î–´–î–£–©–ò–ú–ò –í–ï–†–°–ò–Ø–ú–ò")
    print("=" * 50)
    
    print("üìà –°—Ç–∞—Ä—ã–µ –∫–æ–º–º–∏—Ç—ã (—Ü–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏):")
    print("   ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 12-14 —Å–µ–∫—É–Ω–¥")
    print("   ‚Ä¢ –õ—É—á—à–µ–µ –≤—Ä–µ–º—è: 12.15 —Å–µ–∫—É–Ω–¥")
    print("   ‚Ä¢ –•—É–¥—à–µ–µ –≤—Ä–µ–º—è: 14 —Å–µ–∫—É–Ω–¥")
    print()
    
    print("üìâ –ü—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è (speed):")
    print("   ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 37.2 —Å–µ–∫—É–Ω–¥—ã")
    print("   ‚Ä¢ –õ—É—á—à–µ–µ –≤—Ä–µ–º—è: 36.5 —Å–µ–∫—É–Ω–¥")
    print("   ‚Ä¢ –•—É–¥—à–µ–µ –≤—Ä–µ–º—è: 37.5 —Å–µ–∫—É–Ω–¥")
    print()
    
    print("üéØ –¶–µ–ª—å —Ç—É—Ä–±–æ-–≤–µ—Ä—Å–∏–∏:")
    print("   ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 8-15 —Å–µ–∫—É–Ω–¥")
    print("   ‚Ä¢ –õ—É—á—à–µ–µ –≤—Ä–µ–º—è: <12 —Å–µ–∫—É–Ω–¥")
    print("   ‚Ä¢ –•—É–¥—à–µ–µ –≤—Ä–µ–º—è: <20 —Å–µ–∫—É–Ω–¥")
    print()
    
    print("üîß –ö–ª—é—á–µ–≤—ã–µ —Ç—É—Ä–±–æ-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:")
    print("   ‚Ä¢ –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∫–ª–∏–∫ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞ (—É–±—Ä–∞–Ω–∞ –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞)")
    print("   ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞: 0.5 —Å–µ–∫ (–±—ã–ª–æ 2.5 —Å–µ–∫)")
    print("   ‚Ä¢ –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (—É–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ HTML)")
    print("   ‚Ä¢ –°–æ–∫—Ä–∞—â–µ–Ω—ã –≤—Å–µ –ø–∞—É–∑—ã –≤ 2-5 —Ä–∞–∑")
    print("   ‚Ä¢ –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–∞–∂–¥—ã–µ 0.2 —Å–µ–∫")
    print("   ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")

if __name__ == "__main__":
    print("üöÄ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –¢–£–†–ë–û-–°–ö–û–†–û–°–¢–ò")
    print("–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–ª–∞—Ç–µ–∂–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞ 8-15 —Å–µ–∫—É–Ω–¥ –∫–∞–∫ –≤ —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–º–∏—Ç–∞—Ö")
    print()
    
    # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏
    compare_with_previous()
    
    # –û–¥–∏–Ω–æ—á–Ω—ã–π —Ç–µ—Å—Ç
    single_success, _ = test_turbo_single()
    
    if single_success:
        # –ï—Å–ª–∏ –æ–¥–∏–Ω–æ—á–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ—à–µ–ª, –¥–µ–ª–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π
        multiple_success = test_turbo_multiple()
        
        if multiple_success:
            print("\nüéâ –í–°–ï –¢–ï–°–¢–´ –¢–£–†–ë–û-–°–ö–û–†–û–°–¢–ò –ü–†–û–ô–î–ï–ù–´!")
            print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤")
        else:
            print("\n‚ö†Ô∏è –û–¥–∏–Ω–æ—á–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ—à–µ–ª, –Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —á–∞—Å—Ç–∏—á–Ω–æ –Ω–µ—É–¥–∞—á–µ–Ω")
            print("–°–∏—Å—Ç–µ–º–∞ —É—Å–∫–æ—Ä–µ–Ω–∞, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏")
    else:
        print("\n‚ùå –û–î–ò–ù–û–ß–ù–´–ô –¢–ï–°–¢ –ù–ï –ü–†–û–®–ï–õ")
        print("–ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç—É—Ä–±–æ-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏")